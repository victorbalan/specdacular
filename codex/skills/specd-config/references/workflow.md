<!-- AUTO-GENERATED by bin/build-codex.js — DO NOT EDIT DIRECTLY -->
<!-- Source: Claude Code commands + workflows. Run: npm run build:codex -->

<purpose>
Create or update `.specd/config.json` with global specd settings.

Supports:
- `auto_commit_docs` — Whether to auto-commit `.specd/` file changes (default: true)
- `auto_commit_code` — Whether to auto-commit implementation code changes (default: true)

Preserves any existing fields in the config file (e.g., `type` for orchestrator mode).
</purpose>

<process>

<step name="check_existing">
Check if `.specd/config.json` already exists.

```bash
[ -f ".specd/config.json" ] && echo "exists" || echo "missing"
```

**If exists:**
Read the file and parse current values.

```
Current `.specd/config.json`:

- `auto_commit_docs`: {value or "not set"}
- `auto_commit_code`: {value or "not set"}
{any other fields shown as context}
```

**If missing:**
```
No `.specd/config.json` found. Will create one with commit settings.
```

Continue to ask_settings.
</step>

<step name="ask_settings">
Ask user for preferred commit settings.

Use ask_user_question:
- header: "Commit Settings"
- question: "Which auto-commit settings do you want?"
- options:
  - "Both on (default)" — `auto_commit_docs: true, auto_commit_code: true`
  - "Docs only" — `auto_commit_docs: true, auto_commit_code: false`
  - "Code only" — `auto_commit_docs: false, auto_commit_code: true`
  - "Both off" — `auto_commit_docs: false, auto_commit_code: false`

Map the selection to values:
- "Both on (default)": `auto_commit_docs = true`, `auto_commit_code = true`
- "Docs only": `auto_commit_docs = true`, `auto_commit_code = false`
- "Code only": `auto_commit_docs = false`, `auto_commit_code = true`
- "Both off": `auto_commit_docs = false`, `auto_commit_code = false`

Continue to write_config.
</step>

<step name="write_config">
Write the config file, preserving any existing fields.

**If `.specd/config.json` exists:**
Read the existing JSON. Merge `auto_commit_docs` and `auto_commit_code` into it, preserving all other fields.

**If `.specd/config.json` does not exist:**
Create `.specd/` directory if needed, then write new config with just the commit settings.

**Ensure `.specd/` directory exists:**
```bash
mkdir -p .specd
```

**Write config:**
Write `.specd/config.json` with the merged content. Example:
```json
{
  "auto_commit_docs": true,
  "auto_commit_code": true
}
```

Continue to confirm.
</step>

<step name="confirm">
Show the final config to the user.

```
Config written to `.specd/config.json`:

{display full JSON content}

**Settings:**
- Auto-commit docs (.specd/ files): {on|off}
- Auto-commit code (implementation): {on|off}

These settings apply to all specd workflows in this project.
To change later, run `/specd:config` again.
```

End workflow.
</step>

</process>

<success_criteria>
- [ ] `.specd/config.json` exists with `auto_commit_docs` and `auto_commit_code` fields
- [ ] Existing config fields preserved (not overwritten)
- [ ] User confirmed settings via ask_user_question
- [ ] Final config displayed to user
</success_criteria>
