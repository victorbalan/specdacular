# Roadmap: agent-skills-migration

## Overview

| Metric | Value |
|--------|-------|
| Total Phases | 2 |
| Total Plans | TBD (created per-phase) |
| Current Phase | 1 |
| Status | Not Started |

---

## Phases

- [ ] **Phase 1: Atomic Rules Output** — Update map-codebase to output rules/ instead of PATTERNS.md
- [ ] **Phase 2: Migration & Version Detection** — Migration script + old format detection + workflow reference updates

---

## Phase Details

### Phase 1: Atomic Rules Output

**Goal:** Change map-codebase so it outputs atomic `rules/` files instead of monolithic PATTERNS.md. Each rule follows the Vercel template format. New output includes `_sections.md`, `_template.md`, and `version.json`.

**Creates:**
- `.specd/codebase/rules/_sections.md` — Category definitions (generated by mapper agent)
- `.specd/codebase/rules/_template.md` — Rule format reference (generated by mapper agent)
- `.specd/codebase/rules/{prefix}-{name}.md` — Individual atomic rule files
- `.specd/codebase/version.json` — `{ "version": 2 }`

**Modifies:**
- `specdacular/workflows/map-codebase.md` — Output format change: rules/ instead of PATTERNS.md
- `specdacular/agents/specd-codebase-mapper.md` — Agent instructions for atomic rule output format

**Success Criteria:**
1. Running `/specd.map-codebase` produces `.specd/codebase/rules/` directory
2. Each rule file follows Vercel template (property table + incorrect/correct examples)
3. `_sections.md` lists categories with impact levels and filename prefixes
4. `version.json` written with `{ "version": 2 }`
5. MAP.md, STRUCTURE.md, CONCERNS.md still produced unchanged
6. No PATTERNS.md produced (replaced by rules/)

**Dependencies:** None (first phase)

---

### Phase 2: Migration & Version Detection

**Goal:** Help existing users transition from PATTERNS.md to rules/. Detect old format on command run, offer migration, and update any workflow references that read PATTERNS.md.

**Creates:**
- Migration script (Node.js or standalone workflow) that converts PATTERNS.md → rules/ files
- Version detection logic (check for version.json on specd command run)

**Modifies:**
- Workflows that reference `.specd/codebase/PATTERNS.md` — update to read from `rules/` instead
- `specdacular/workflows/map-codebase.md` — Add version check + migration offer at start
- Any command entry points — Add version.json check

**Success Criteria:**
1. Running any specd command on a project with old PATTERNS.md (no version.json) triggers migration prompt
2. Migration converts PATTERNS.md content into atomic rules/ files
3. Migration writes version.json after conversion
4. Workflows that referenced PATTERNS.md now read from rules/
5. Existing projects continue working during and after migration

**Dependencies:** Phase 1 complete (new format must exist to migrate to)

---

## Execution Order

```
Phase 1: Atomic Rules Output
├── Update map-codebase workflow
├── Update specd-codebase-mapper agent
├── New output: rules/, _sections.md, _template.md, version.json
└── Test on this project
    ↓
Phase 2: Migration & Version Detection
├── Migration script (PATTERNS.md → rules/)
├── Version detection on command run
├── Update workflow references
└── Test on project with old format
```

---

## Key Decisions Affecting Roadmap

| Decision | Impact on Phases |
|----------|------------------|
| DEC-004: Replace PATTERNS.md with atomic rules/ | Phase 1 core deliverable |
| DEC-005: _sections.md for codebase rules | Phase 1 includes _sections.md generation |
| DEC-006: version.json for format tracking | Phase 1 writes it, Phase 2 checks it |

---

## Notes

Scope reduced from original feature definition. The SKILL.md command system migration (replacing commands/specd. with SKILL.md routing) is deferred to a separate future effort. This feature focuses exclusively on the map-codebase output format change and migration tooling.
