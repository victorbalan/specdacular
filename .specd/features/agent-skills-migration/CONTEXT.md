# Context: agent-skills-migration

**Last Updated:** 2026-02-09
**Sessions:** 2

## Discussion Summary

Analyzed Specdacular's current architecture against the Agent Skills open standard (agentskills.io). Identified that the current custom command system (YAML frontmatter in `commands/specd.*.md` pointing to monolithic workflows in `specdacular/workflows/*.md`) wastes context and limits interoperability. The Agent Skills standard offers progressive disclosure (50 tokens at startup vs thousands), cross-tool support, and standard validation tooling. Vercel's React Best Practices skill was studied as a reference implementation: 57 atomic rules, compact SKILL.md router, `_sections.md` for categories.

Session 2 studied the Vercel rules/ structure in depth (SKILL.md, rules/_sections.md, rules/_template.md, individual atomic rule files). Key insight: adopting the Agent Skills standard applies to both Specdacular's own packaging AND the codebase documentation output. Map-codebase should output atomic rules/ instead of monolithic PATTERNS.md, following the same Vercel pattern. Migration path uses version.json for format detection.

---

## Resolved Questions

### Migration approach

**Question:** Should we migrate all at once or incrementally?

**Resolution:** Incremental migration with backward compatibility period.

**Details:**
- Create new SKILL.md structure alongside existing commands
- Migrate workflows one at a time to `references/`
- Deprecate old command files once new structure is validated
- Remove old structure in a final cleanup phase

**Related Decisions:** DEC-001

---

### Directory structure

**Question:** What directory layout should the skill use?

**Resolution:** Follow Agent Skills standard: `references/`, `assets/`, `scripts/`

**Details:**
- `references/workflows/` — Individual workflow files (loaded on demand)
- `references/agents/` — Agent definitions (loaded when spawning)
- `assets/templates/` — Template files (loaded when creating)
- `scripts/` — Automation scripts

### Codebase output format change

**Question:** Should map-codebase output change to follow the Agent Skills atomic rules pattern?

**Resolution:** Yes. Replace PATTERNS.md with atomic `rules/` directory following Vercel's structure.

**Details:**
- MAP.md, STRUCTURE.md, CONCERNS.md stay as-is (they're descriptive, not prescriptive)
- PATTERNS.md replaced by `rules/` directory with atomic rule files
- Each rule follows Vercel template: title, impact, tags, incorrect/correct examples
- `_sections.md` defines categories with impact levels
- Mapper agents extract rules from actual codebase patterns

**Related Decisions:** DEC-004

---

### `_sections.md` usage

**Question:** Is the Vercel `_sections.md` categorization pattern needed for Specdacular's own commands?

**Resolution:** No for Specdacular's own SKILL.md (only ~15 commands, categories implicit in `feature:`/`phase:` prefixes). Yes for codebase rules output (projects can have many rules across categories).

**Details:**
- SKILL.md handles its own command routing directly — compact enough without separate sections file
- Codebase `rules/_sections.md` generated by map-codebase based on patterns found in the project
- Follows Vercel pattern: section ID = filename prefix, includes impact level and description

**Related Decisions:** DEC-005

---

### Codebase docs version tracking

**Question:** How to detect old codebase doc format and offer migration?

**Resolution:** Add `.specd/codebase/version.json` with format version. Current format (with PATTERNS.md) is version 1 (implicit — no file). New format (with rules/) is version 2.

**Details:**
- `version.json` contains `{ "version": 2 }` for new rules/ format
- No version.json = version 1 (PATTERNS.md era)
- On any specd command, check for version.json — if missing or outdated, offer migration
- Migration script converts existing PATTERNS.md into atomic rules/ files

**Related Decisions:** DEC-006

---

## Deferred Questions

### Exact SKILL.md routing syntax

**Reason:** Need to research current Agent Skills standard trigger format in depth
**Default for now:** Follow Vercel React Best Practices pattern
**Revisit when:** During research phase

### Cross-tool installation and testing

**Reason:** Need to investigate how each tool loads skills — research problem, not discussion topic
**Default for now:** Focus on Claude Code, validate Cursor compatibility
**Revisit when:** During research phase

### Progressive disclosure with arguments

**Reason:** Need to research how Agent Skills standard handles commands with arguments (e.g., `feature:discuss {name}`)
**Default for now:** Follow Vercel pattern, adapt for argument passing
**Revisit when:** During research phase

---

## Discussion History

| Date | Topics Covered | Key Outcomes |
|------|----------------|--------------|
| 2026-02-06 | Architecture analysis, standard comparison, reference implementation review | Feature initialized, migration approach decided, directory structure chosen |
| 2026-02-09 | Vercel rules/ structure, codebase output format, _sections.md, version tracking | 3 gray areas resolved, 3 new decisions, remaining deferred to research |

---

## Gray Areas Remaining

None — remaining open questions deferred to research phase.

---

## Quick Reference

- **Feature:** `.specd/features/agent-skills-migration/FEATURE.md`
- **Decisions:** `.specd/features/agent-skills-migration/DECISIONS.md`
- **Research:** `.specd/features/agent-skills-migration/RESEARCH.md` (not yet created)
