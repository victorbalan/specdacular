# Decisions: agent-skills-migration

**Feature:** agent-skills-migration
**Created:** 2026-02-06
**Last Updated:** 2026-02-09

---

## Active Decisions

### DEC-001: Migrate to Agent Skills open standard format

**Date:** 2026-02-06
**Status:** Active
**Phase:** 0
**Context:** Specdacular uses a proprietary command system that only works with Claude Code and loads entire workflows into context at startup. The Agent Skills open standard is supported by Claude Code, Cursor, Gemini CLI, VS Code, and others.
**Decision:** Adopt the Agent Skills open standard as Specdacular's command/skill format.
**Rationale:**
- Progressive disclosure reduces startup context from thousands of tokens to ~50 per command
- Interoperability across all major AI coding tools
- Standard validation tooling (`skills-ref validate`)
- Established ecosystem with growing adoption
**Implications:**
- All commands must be expressible as SKILL.md triggers
- Directory structure must follow `references/`, `assets/`, `scripts/` convention
- Installation simplifies to directory copy
- Backward compatibility period needed during migration

---

### DEC-002: Use Vercel React Best Practices as reference implementation

**Date:** 2026-02-06
**Status:** Active
**Phase:** 0
**Context:** Need a concrete example of a well-structured Agent Skill to model Specdacular's migration after.
**Decision:** Use Vercel's React Best Practices skill as the primary reference for structure and patterns.
**Rationale:**
- Production-proven skill with 57 atomic rules
- Demonstrates compact SKILL.md router pattern
- Shows `_sections.md` for categorization
- Shows `_template.md` for standardized rule format
**Implications:**
- Study Vercel's pattern for SKILL.md organization
- Consider `_sections.md` for Specdacular's command categories (feature:*, phase:*, utility)
- Adapt atomic rule pattern to Specdacular's workflow structure

---

### DEC-003: Incremental migration with backward compatibility

**Date:** 2026-02-06
**Status:** Active
**Phase:** 0
**Context:** Users have existing Specdacular installations using the current command system. Breaking change would disrupt workflows.
**Decision:** Migrate incrementally — create new structure alongside old, deprecate, then remove.
**Rationale:**
- Users can transition at their own pace
- Reduces risk of migration bugs
- Allows testing new structure before committing fully
**Implications:**
- Both old commands/ and new SKILL.md will coexist temporarily
- Need clear deprecation notices in old command files
- Final cleanup phase removes old structure

---

### DEC-004: Replace PATTERNS.md with atomic rules/ directory

**Date:** 2026-02-09
**Status:** Active
**Phase:** 0
**Context:** Map-codebase currently outputs a monolithic PATTERNS.md file. The Vercel Agent Skills pattern uses atomic rule files in a rules/ directory, each with title, impact, tags, and incorrect/correct examples. Adopting the Agent Skills standard should apply consistently to both Specdacular's packaging and its output.
**Decision:** Map-codebase output replaces PATTERNS.md with `rules/` directory containing atomic rule files following the Vercel template format, plus `_sections.md` for category definitions.
**Rationale:**
- Progressive disclosure — load only relevant rules instead of entire PATTERNS.md
- Consistent with Agent Skills standard being adopted for Specdacular itself
- Atomic rules are more actionable (each has incorrect/correct examples)
- MAP.md, STRUCTURE.md, CONCERNS.md remain as-is (descriptive, not prescriptive)
**Implications:**
- Map-codebase mapper agents need updated output format
- Existing users need migration from PATTERNS.md to rules/
- Rule files follow Vercel template: frontmatter (title, impact, tags) + explanation + examples

---

### DEC-005: No _sections.md for Specdacular commands, yes for codebase rules

**Date:** 2026-02-09
**Status:** Active
**Phase:** 0
**Context:** Vercel uses `_sections.md` to define categories for 57 rules. Specdacular has ~15 commands with natural `feature:`/`phase:` prefix grouping, but codebase rules output could have many rules across project-specific categories.
**Decision:** SKILL.md handles Specdacular's own command routing directly (no separate _sections.md). Codebase rules output includes `_sections.md` generated by map-codebase.
**Rationale:**
- ~15 commands are compact enough for SKILL.md to organize directly
- Codebase rules can be numerous and project-specific — need category metadata
- Follows Vercel pattern where it adds value, skips it where it doesn't
**Implications:**
- SKILL.md contains command categories inline
- Map-codebase generates `_sections.md` alongside rule files

---

### DEC-006: Version tracking with version.json for codebase docs format

**Date:** 2026-02-09
**Status:** Active
**Phase:** 0
**Context:** Existing Specdacular users have `.specd/codebase/PATTERNS.md`. New format uses `rules/`. Need a way to detect old format and offer migration.
**Decision:** Add `.specd/codebase/version.json` containing `{ "version": 2 }`. No file = version 1 (old format). Check on specd command run and offer migration.
**Rationale:**
- Single source of truth for codebase docs format version
- Cleaner than sniffing for file existence
- Extensible for future format changes
**Implications:**
- Map-codebase writes version.json alongside other output
- Migration script converts PATTERNS.md to rules/ files
- Specd commands check version.json at startup

---

## Superseded Decisions

(none)

---

## Decision Log

| ID | Date | Title | Status |
|----|------|-------|--------|
| DEC-001 | 2026-02-06 | Migrate to Agent Skills open standard format | Active |
| DEC-002 | 2026-02-06 | Use Vercel React Best Practices as reference implementation | Active |
| DEC-003 | 2026-02-06 | Incremental migration with backward compatibility | Active |
| DEC-004 | 2026-02-09 | Replace PATTERNS.md with atomic rules/ directory | Active |
| DEC-005 | 2026-02-09 | No _sections.md for Specdacular commands, yes for codebase rules | Active |
| DEC-006 | 2026-02-09 | Version tracking with version.json for codebase docs format | Active |
